# 历史遗留的支付到脚本哈希地址（P2SH）

正如我们在前面的章节中所看到的，接收比特币的人（比如Bob）可以要求支付给他的比特币在其输出脚本中包含某些约束条件。当Bob花费这些比特币时，他将需要使用输入脚本来满足这些约束条件。在“IP地址：比特币的原始地址（P2PK）”中，约束条件简单地是输入脚本需要提供适当的签名。在“用于P2PKH的遗留地址”中，还需要提供适当的公钥。

对于支付给Bob的输出脚本中放置Bob想要的约束条件的支出者（比如Alice），Bob需要将这些约束条件传达给她。这类似于Bob需要将他的公钥传达给她的问题。就像这个问题一样，公钥可以相当大，Bob使用的约束条件也可能非常大——潜在地有数千字节。这不仅是需要传达给Alice的数千字节，而且是她每次想向Bob支付款项时都需要支付交易费用的数千字节。然而，使用哈希函数为大量数据创建小承诺的解决方案在这里也适用。

2012年比特币协议的BIP16升级允许输出脚本承诺一个赎回脚本（redeem script）。当Bob花费他的比特币时，他的输入脚本需要提供一个与承诺匹配的赎回脚本，以及满足赎回脚本所需的任何数据（例如签名）。让我们首先想象一下，Bob想要要求两个签名来花费他的比特币，一个来自他的桌面钱包，另一个来自硬件签名设备。他将这些条件放入一个赎回脚本中：

\<public key 1> OP\_CHECKSIGVERIFY \<public key 2> OP\_CHECKSIG

然后，他使用与P2PKH承诺相同的HASH160机制创建对赎回脚本的承诺，即RIPEMD160（SHA256（脚本））。该承诺被放置到输出脚本中，使用特殊的模板：

OP\_HASH160 OP\_EQUAL

{% hint style="danger" %}
使用支付至脚本哈希（P2SH）时，必须使用特定的P2SH模板，在输出脚本中没有额外的数据或条件。如果输出脚本不是完全是 OP\_HASH160 <20字节> OP\_EQUAL，赎回脚本将不会被使用，而且任何比特币可能要么无法支配，要么可以被任何人支配（意味着任何人都可以取走它们）。
{% endhint %}

当Bob要花费他收到的支付，用于他脚本的承诺时，他会使用一个包含赎回脚本的输入脚本，将其序列化为一个单独的数据元素。他还提供了满足赎回脚本所需的签名，按照它们被操作码消耗的顺序放置：

