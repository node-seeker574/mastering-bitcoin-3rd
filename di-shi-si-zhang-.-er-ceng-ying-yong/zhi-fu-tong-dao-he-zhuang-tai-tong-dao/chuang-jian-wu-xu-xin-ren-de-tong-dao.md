# 创建无需信任的通道

刚刚描述的通道只有在双方合作、没有任何故障或试图欺骗的情况下才能运作。让我们看看一些破坏这一通道的情况，并看看如何修复：

• 一旦发生资金交易，Emma 需要 Fabian 的签名才能拿回任何资金。如果 Fabian 消失，Emma 的资金将被锁定在 2-of-2 中，并且实际上丢失了。如果在至少有一份双方签署的承诺交易之前，其中一方变得不可用，那么按照当前构建的通道，资金将会丢失。&#x20;

• 在通道运行期间，Emma 可以取任何 Fabian 已经签署的承诺交易中的一份并将其传输到区块链。如果她可以传输承诺交易＃1 并仅支付 1 秒的视频，为什么要支付 600 秒的视频呢？Emma 可以通过广播对她有利的先前承诺来欺骗，这导致通道失败。

这两个问题都可以通过时间锁解决——让我们看看如何使用交易级时间锁。

Emma 不能冒险进行 2-of-2 多重签名资金，除非她有一种保证的退款。为了解决这个问题，Emma 同时构建了资金和退款交易。她签署了资金交易，但不将其传输给任何人。Emma 仅将退款交易传输给 Fabian 并获得他的签名。

退款交易充当了第一笔承诺交易，其时间锁确定了通道的生命周期上限。在这种情况下，Emma 可以将锁定时间设置为 30 天或未来 4,320 个区块。在之后的所有承诺交易必须有一个更短的时间锁，以便在退款交易到期之前赎回。

现在，Emma 有了一个完全签名的退款交易，她可以放心地传输已签名的资金交易，知道即使 Fabian 消失，她也可以在时间锁到期后赎回退款交易。

在通道的生命周期内，双方交换的每笔承诺交易都将被时间锁定到未来。但是，对于每个承诺，延迟都会略微缩短，以便最新的承诺在使其无效的先前承诺之前可以被赎回。由于时间锁，没有一方能够成功传播任何承诺交易，直到其时间锁到期。如果一切顺利，他们将合作并以和解交易优雅地关闭通道，无需传输中间承诺交易。如果没有，最新的承诺交易可以传播以结算账户并使所有先前的承诺交易无效。

例如，如果承诺交易＃1 被时间锁定到未来的 4,320 个区块，那么承诺交易＃2 将被时间锁定到未来的 4,319 个区块。承诺交易＃600 可以在承诺交易＃1 生效之前的 600 个区块被消费。

图 14-4. 显示了每个承诺交易设置了一个较短的时间锁，使其可以在先前的承诺变为有效之前被消费

<figure><img src="../../.gitbook/assets/14.4.png" alt=""><figcaption><p>图 14-4 . 每个承诺交易都设置了较短的时间锁，使其可以在先前的承诺变为有效之前被消费</p></figcaption></figure>

